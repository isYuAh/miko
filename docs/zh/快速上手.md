# å¿«é€Ÿä¸Šæ‰‹

æœ¬æ•™ç¨‹å°†å¸®åŠ©ä½ åœ¨ 5 åˆ†é’Ÿå†…ä¸Šæ‰‹ Miko æ¡†æ¶ï¼Œåˆ›å»ºä½ çš„ç¬¬ä¸€ä¸ª Web åº”ç”¨ã€‚

## å‰ç½®è¦æ±‚

- Rust 1.75 æˆ–æ›´é«˜ç‰ˆæœ¬
- Cargo åŒ…ç®¡ç†å™¨

## åˆ›å»ºæ–°é¡¹ç›®

```bash
cargo new my-miko-app
cd my-miko-app
```

## æ·»åŠ ä¾èµ–

ç¼–è¾‘ `Cargo.toml` æ–‡ä»¶ï¼š

```toml
[dependencies]
miko = { version = "0.3.5", features = ["full"] }
tokio = { version = "1", features = ["full"] }
serde = { version = "1", features = ["derive"] }
```

> **Features è¯´æ˜**
> - `full`: å¯ç”¨æ‰€æœ‰åŠŸèƒ½ï¼Œé€‚åˆå¿«é€Ÿå¼€å§‹
> - å¦‚éœ€æ›´ç»†ç²’åº¦çš„æ§åˆ¶ï¼Œå¯ä»¥åªå¯ç”¨éœ€è¦çš„ featuresï¼ˆå‚è§ [åŸºç¡€æ¦‚å¿µ](åŸºç¡€æ¦‚å¿µ.md#features)ï¼‰

## Hello World

åˆ›å»ºæœ€ç®€å•çš„åº”ç”¨ï¼Œç¼–è¾‘ `src/main.rs`ï¼š

```rust
use miko::*;

// å®šä¹‰ä¸€ä¸ªç®€å•çš„å¤„ç†å‡½æ•°
#[get("/")]
async fn hello() -> &'static str {
    "Hello, Miko!"
}

// ä½¿ç”¨ #[miko] å®è‡ªåŠ¨é…ç½®å’Œå¯åŠ¨åº”ç”¨ï¼ˆæ¨èï¼‰
#[miko]
async fn main() {
    // router å·²è‡ªåŠ¨åˆ›å»º
    // è·¯ç”±ä¼šè‡ªåŠ¨æ”¶é›†å¹¶æ³¨å†Œ
    // é…ç½®ä¼šè‡ªåŠ¨åŠ è½½
}
```

> **`#[miko]` å®çš„åŠŸèƒ½**ï¼š
> - è‡ªåŠ¨å±•å¼€ä¸º `#[tokio::main]`
> - è‡ªåŠ¨åˆ›å»º `router: Router`
> - è‡ªåŠ¨æ”¶é›† `#[get]`ã€`#[post]` ç­‰å®å®šä¹‰çš„è·¯ç”±å¹¶æ³¨å†Œï¼ˆéœ€è¦ `auto` featureï¼‰
> - è‡ªåŠ¨åŠ è½½ `config.toml` å¹¶åˆå¹¶ `config.{dev/prod}.toml`
> - åˆå§‹åŒ–å…¨å±€ä¾èµ–å®¹å™¨ï¼ˆéœ€è¦ `auto` featureï¼‰
> - è‡ªåŠ¨è¿è¡Œåº”ç”¨

è¿è¡Œåº”ç”¨ï¼š

```bash
cargo run
```

è®¿é—® `http://localhost:8080`ï¼Œä½ ä¼šçœ‹åˆ° "Hello, Miko!"

### ä¸ä½¿ç”¨å®çš„æ–¹å¼

å¦‚æœä¸æƒ³ä½¿ç”¨ `#[miko]` å®ï¼Œå¯ä»¥æ‰‹åŠ¨é…ç½®ï¼š

```rust
use miko::*;

#[tokio::main]
async fn main() {
    let router = Router::new()
        .get("/", || async { "Hello, Miko!" });
    
    // ä¸åŠ è½½é…ç½®æ–‡ä»¶ï¼Œä½¿ç”¨é»˜è®¤é…ç½®
    let config = ApplicationConfig::default();
    Application::new(config, router).run().await.unwrap();
}
```

## JSON API

ç°åœ¨è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªè¿”å› JSON çš„ APIï¼š

```rust
use miko::{*, extractor::Json};
use serde::{Deserialize, Serialize};

#[derive(Serialize)]
struct Message {
    text: String,
    timestamp: u64,
}

#[get("/api/message")]
async fn get_message() -> Json<Message> {
    Json(Message {
        text: "Hello from Miko!".to_string(),
        timestamp: std::time::SystemTime::now()
            .duration_since(std::time::UNIX_EPOCH)
            .unwrap()
            .as_secs(),
    })
}

#[miko]
async fn main() {
    // è·¯ç”±è‡ªåŠ¨æ³¨å†Œ
}
```

è®¿é—® `http://localhost:8080/api/message`ï¼Œä½ ä¼šå¾—åˆ° JSON å“åº”ã€‚

## å¤„ç†è¯·æ±‚æ•°æ®

### è·¯å¾„å‚æ•°

```rust
use miko::{*, extractor::{Json, Path}};

#[derive(Serialize)]
struct User {
    id: u32,
    name: String,
}

#[get("/users/{id}")]
async fn get_user(Path(id): Path<u32>) -> Json<User> {
    Json(User {
        id,
        name: format!("User {}", id),
    })
}
```

è®¿é—® `http://localhost:8080/users/123`

### æŸ¥è¯¢å‚æ•°

```rust
use std::collections::HashMap;
use miko::{*, extractor::Query};

#[derive(Deserialize)]
struct QueryStruct {
  q: String
}

#[get("/search")]
async fn search(Query(params): Query<QueryStruct>) -> String {
    let keyword = params.q;
    format!("Searching for: {}", keyword)
}
```

è®¿é—® `http://localhost:8080/search?q=rust`

### POST è¯·æ±‚ä½“

```rust
#[derive(Deserialize)]
struct CreateUser {
    name: String,
    email: String,
}

#[derive(Serialize)]
struct UserResponse {
    id: u32,
    name: String,
    email: String,
}

#[post("/users")]
async fn create_user(Json(data): Json<CreateUser>) -> Json<UserResponse> {
    Json(UserResponse {
        id: 1,
        name: data.name,
        email: data.email,
    })
}
```

æµ‹è¯•ï¼š

```bash
curl -X POST http://localhost:8080/users \
  -H "Content-Type: application/json" \
  -d '{"name":"Alice","email":"alice@example.com"}'
```

## å®Œæ•´ç¤ºä¾‹

ä¸€ä¸ªåŒ…å«å¤šä¸ªè·¯ç”±çš„å®Œæ•´åº”ç”¨ï¼š

```rust
use miko::{*, extractor::{Json, Path, Query}};
use serde::{Deserialize, Serialize};
use std::collections::HashMap;

#[derive(Serialize)]
struct User {
    id: u32,
    name: String,
    email: String,
}

#[derive(Deserialize)]
struct CreateUser {
    name: String,
    email: String,
}

// é¦–é¡µ
#[get("/")]
async fn index() -> &'static str {
    "Welcome to Miko API!"
}

#[derive(serde::Deserialize)]
struct ListQuery {
  limit: Option<usize>,
}

#[get("/users")]
async fn list_users(Query(params): Query<ListQuery>) -> Json<Vec<User>> {
  let limit = params.limit.unwrap_or(10) as u32;
  let users: Vec<User> = (1..=limit)
    .map(|id| User {
      id,
      name: format!("User {}", id),
      email: format!("user{}@example.com", id),
    })
    .collect();
  Json(users)
}

// è·å–å•ä¸ªç”¨æˆ·
#[get("/users/{id}")]
async fn get_user(Path(id): Path<u32>) -> Json<User> {
    Json(User {
        id,
        name: format!("User {}", id),
        email: format!("user{}@example.com", id),
    })
}

// åˆ›å»ºç”¨æˆ·
#[post("/users")]
async fn create_user(Json(data): Json<CreateUser>) -> Json<User> {
    Json(User {
        id: 999,
        name: data.name,
        email: data.email,
    })
}

#[miko]
async fn main() {
    // æ‰€æœ‰è·¯ç”±è‡ªåŠ¨æ³¨å†Œ
}
```

## æµ‹è¯• API

```bash
# è®¿é—®é¦–é¡µ
curl http://localhost:8080/

# è·å–ç”¨æˆ·åˆ—è¡¨
curl http://localhost:8080/users

# è·å–ç”¨æˆ·åˆ—è¡¨ï¼ˆé™åˆ¶æ•°é‡ï¼‰
curl http://localhost:8080/users?limit=5

# è·å–å•ä¸ªç”¨æˆ·
curl http://localhost:8080/users/1

# åˆ›å»ºç”¨æˆ·
curl -X POST http://localhost:8080/users \
  -H "Content-Type: application/json" \
  -d '{"name":"Alice","email":"alice@example.com"}'
```

## é…ç½®æœåŠ¡å™¨

é»˜è®¤æƒ…å†µä¸‹ï¼ŒMiko ç›‘å¬ `0.0.0.0:8080`ã€‚ä½ å¯ä»¥é€šè¿‡é…ç½®æ–‡ä»¶ä¿®æ”¹ï¼š

åˆ›å»º `config.toml`ï¼š

```toml
[application]
addr = "127.0.0.1"
port = 9999
```

`#[miko]` å®ä¼šè‡ªåŠ¨åŠ è½½é…ç½®ã€‚åœ¨å¼€å‘ç¯å¢ƒï¼ˆdebug æ¨¡å¼ï¼‰ä¸­ï¼Œå¦‚æœå­˜åœ¨ `config.dev.toml`ï¼Œå®ƒä¼šä¸ `config.toml` åˆå¹¶ï¼›åœ¨ç”Ÿäº§ç¯å¢ƒï¼ˆrelease æ¨¡å¼ï¼‰ä¸­ä¼šä½¿ç”¨ `config.prod.toml`ã€‚

æ›´å¤šé…ç½®é€‰é¡¹è¯·å‚è§ [é…ç½®ç®¡ç†](é…ç½®ç®¡ç†.md)ã€‚

## ä¸‹ä¸€æ­¥

æ­å–œï¼ä½ å·²ç»æŒæ¡äº† Miko çš„åŸºç¡€ç”¨æ³•ã€‚æ¥ä¸‹æ¥ä½ å¯ä»¥ï¼š

- ğŸ“– é˜…è¯» [åŸºç¡€æ¦‚å¿µ](åŸºç¡€æ¦‚å¿µ.md) æ·±å…¥äº†è§£æ¡†æ¶æ¶æ„
- ğŸ›£ï¸ å­¦ä¹  [è·¯ç”±ç³»ç»Ÿ](è·¯ç”±ç³»ç»Ÿ.md) çš„é«˜çº§ç”¨æ³•
- ğŸ” æ¢ç´¢ [é”™è¯¯å¤„ç†](é”™è¯¯å¤„ç†.md) æœºåˆ¶
- ğŸ’‰ ä½¿ç”¨ [ä¾èµ–æ³¨å…¥](ä¾èµ–æ³¨å…¥.md) ç®¡ç†ç»„ä»¶
- ğŸ“ é›†æˆ [OpenAPI](OpenAPIé›†æˆ.md) ç”Ÿæˆæ–‡æ¡£
- âœ… æ·»åŠ  [æ•°æ®éªŒè¯](æ•°æ®éªŒè¯.md)

æŸ¥çœ‹ `miko/examples/` ç›®å½•è·å–æ›´å¤šå®Œæ•´ç¤ºä¾‹ã€‚
